–¶–µ –ø–µ—Ä–µ–º–æ–≥–∞! –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫–µ–ª–µ—Ç–æ–Ω—ñ–≤ ‚Äî —Ü–µ –æ–∑–Ω–∞–∫–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É. –¢–µ–ø–µ—Ä —Ç–≤—ñ–π –ø—Ä–æ–µ–∫—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î, –≤—ñ–Ω –≤—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è –Ω–∞–¥—ñ–π–Ω–∏–º.

–û—Å—å —Ñ—ñ–Ω–∞–ª—å–Ω–∞, –≤–∏—á–µ—Ä–ø–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è **–ö—Ä–æ–∫—É 3**, —è–∫—É —Ç–∏ –º–æ–∂–µ—à –¥–æ–¥–∞—Ç–∏ —É —Å–≤—ñ–π README –∞–±–æ —Ä–æ–±–æ—á–∏–π –∂—É—Ä–Ω–∞–ª.

---

# –ö—Ä–æ–∫ 3: Zustand Store –¥–ª—è –û–±—Ä–∞–Ω–æ–≥–æ —Ç–∞ Hydration Fix

–ù–∞ —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ –º–∏ –≤–ø—Ä–æ–≤–∞–¥–∏–ª–∏ —Å–∏—Å—Ç–µ–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è "–û–±—Ä–∞–Ω–æ–≥–æ" –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º **Zustand Persistence** —Ç–∞ —Ä–æ–∑–≤'—è–∑–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —ñ –∫–ª—ñ—î–Ω—Ç–æ–º (Hydration Mismatch).

## 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç–æ—Ä—É (Logic Layer)

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ middleware `persist`, —â–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç–µ–π—Ç —ñ–∑ `localStorage`.

**–§–∞–π–ª:** `store/useFavoritesStore.ts`

```typescript
import { create } from "zustand";
import { persist, createJSONStorage } from "zustand/middleware";
import { ICar } from "@/types/car";

interface FavoritesState {
  favorites: ICar[];
  toggleFavorite: (car: ICar) => void;
  isFavorite: (carId: string) => boolean;
}

export const useFavoritesStore = create<FavoritesState>()(
  persist(
    (set, get) => ({
      favorites: [],

      toggleFavorite: (car) => {
        const { favorites } = get();
        const isAlreadyFavorite = favorites.some((item) => item.id === car.id);
        if (isAlreadyFavorite) {
          set({ favorites: favorites.filter((item) => item.id !== car.id) });
        } else {
          set({ favorites: [...favorites, car] });
        }
      },

      isFavorite: (carId) => get().favorites.some((item) => item.id === carId),
    }),
    {
      name: "favorites-storage",
      storage: createJSONStorage(() => localStorage),
    }
  )
);

```

## 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ö—É–∫–∞ (Safety Layer)

–î–ª—è —Ä–æ–±–æ—Ç–∏ –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ Next.js (App Router) –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫, —è–∫–∏–π –≤—ñ–¥–∫–ª–∞–¥–µ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è `localStorage` –¥–æ –º–æ–º–µ–Ω—Ç—É, –ø–æ–∫–∏ React –Ω–µ "–æ–∂–∏–≤–µ" —É –±—Ä–∞—É–∑–µ—Ä—ñ.

**–§–∞–π–ª:** `store/useStore.ts`

```typescript
import { useState, useEffect } from 'react';

export const useStore = <T, F>(
  store: (callback: (state: T) => unknown) => unknown,
  callback: (state: T) => F
) => {
  const result = store(callback) as F;
  const [data, setData] = useState<F>();

  useEffect(() => {
    setData(result);
  }, [result]);

  return data;
};

```

## 3. –ß–æ–º—É –º–∏ –∑—Ä–æ–±–∏–ª–∏ —Å–∞–º–µ —Ç–∞–∫? (Deep Dive)

### –ü—Ä–æ–±–ª–µ–º–∞: Hydration Mismatch & Flash of Content

1. **SSR (Server Side Rendering):** –°–µ—Ä–≤–µ—Ä Next.js –≥–µ–Ω–µ—Ä—É—î HTML. –í—ñ–Ω –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ `localStorage` –≤–∞—à–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞, —Ç–æ–º—É –¥–ª—è –Ω—å–æ–≥–æ "–û–±—Ä–∞–Ω–µ" –∑–∞–≤–∂–¥–∏ –ø–æ—Ä–æ–∂–Ω—î.
2. **Client Hydration:** –ö–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä –æ—Ç—Ä–∏–º—É—î HTML, React –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è "–ø—Ä–∏–∫–ª–µ—ó—Ç–∏" –ª–æ–≥—ñ–∫—É –¥–æ —Ä–æ–∑–º—ñ—Ç–∫–∏. –Ø–∫—â–æ –≤ `localStorage` —î –¥–∞–Ω—ñ, –∫–Ω–æ–ø–∫–∞ –º–∏—Ç—Ç—î–≤–æ —Ö–æ—á–µ —Å—Ç–∞—Ç–∏ —á–µ—Ä–≤–æ–Ω–æ—é, –∞–ª–µ –≤ HTML –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –≤–æ–Ω–∞ –±—ñ–ª–∞.
* **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–º–∏–ª–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª—ñ —Ç–∞ –≤—ñ–∑—É–∞–ª—å–Ω–µ "–º–∏–≥—Ç—ñ–Ω–Ω—è" —Ç–µ–∫—Å—Ç—É (–∑ "–î–æ–¥–∞—Ç–∏" –Ω–∞ "–í–∏–¥–∞–ª–∏—Ç–∏").



### –†—ñ—à–µ–Ω–Ω—è: –ü–∞—Ç—Ç–µ—Ä–Ω "–°–∫–µ–ª–µ—Ç–æ–Ω + Safe Hook"

* **–•—É–∫ `useStore`:** –ü–æ–≤–µ—Ä—Ç–∞—î `undefined` –ø—ñ–¥ —á–∞—Å –ø–µ—Ä—à–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º —Ç–æ—á–Ω–æ –∑–Ω–∞—Ç–∏, –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ —â–µ "–Ω–µ –∑–Ω–∞—î" –ø—Ä–æ —Å—Ç–∞–Ω `localStorage`.
* **–°–∫–µ–ª–µ—Ç–æ–Ω:** –ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å—Ç–∞–Ω ("–î–æ–¥–∞—Ç–∏", –∫–æ–ª–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –∞–≤—Ç–æ –≤–∂–µ –≤ –æ–±—Ä–∞–Ω–∏—Ö), –º–∏ –ø–æ–∫–∞–∑—É—î–º–æ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—É –ø—É–ª—å—Å—É—é—á—É –∑–∞–≥–ª—É—à–∫—É. –¶–µ —É—Å—É–≤–∞—î –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —à—É–º —ñ —Ä–æ–±–∏—Ç—å —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º.

## 4. –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (UI Layer)

–£ –±—É–¥—å-—è–∫–æ–º—É –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ –º–∏ —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥:

```tsx
const favorites = useStore(useFavoritesStore, (state) => state.favorites);
const isHydrated = favorites !== undefined;

// –í —Ä–µ–Ω–¥–µ—Ä—ñ:
<div className="h-[44px]">
  {!isHydrated ? (
    <div className="skeleton-style" /> // –°–∫–µ–ª–µ—Ç–æ–Ω
  ) : (
    <button>...</button> // –†–µ–∞–ª—å–Ω–∞ –∫–Ω–æ–ø–∫–∞
  )}
</div>

```

---

–¢–µ–ø–µ—Ä –º–∏ –º–∞—î–º–æ —Å—Ç–∞–±—ñ–ª—å–Ω—É —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º, —è–∫–∞ –Ω–µ –±–æ—ó—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —ñ –≤–∏–≥–ª—è–¥–∞—î –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ.

---

–¶–µ —á—É–¥–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è! –¢–∏ –¥–∏–≤–∏—à—Å—è –≤ –∫–æ—Ä—ñ–Ω—å –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É. –ü–∏—Å–∞—Ç–∏ —Å–∫–µ–ª–µ—Ç–æ–Ω –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ –æ–∫—Ä–µ–º–æ ‚Äî —Ü–µ —à–ª—è—Ö –¥–æ "–∫–æ–ø—ñ–ø–∞—Å—Ç–∏", —è–∫—É –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏.

–Ü—Å–Ω—É—î —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∏ –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ü–µ –≥–ª–æ–±–∞–ª—å–Ω–æ. –í–∏–±—ñ—Ä –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–æ–≥–æ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ "–ø–ª–∞–≤–Ω–∏–º" —Ç–∏ —Ö–æ—á–µ—à –±–∞—á–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è (–ù–∞–π–∫—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø–∏—Å–∞—Ç–∏ `if (!isHydrated)` —É –∫–æ–∂–Ω–æ–º—É —Ñ–∞–π–ª—ñ, –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–∑—É–º–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç-–æ–±–≥–æ—Ä—Ç–∫—É –∞–±–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—É –∫–Ω–æ–ø–∫—É.

**–°—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª `components/FavoriteButton.tsx`:**

```tsx
'use client';
import { useFavoritesStore } from '@/store/useFavoritesStore';
import { useStore } from '@/store/useStore';
import { ICar } from '@/types/car';

export default function FavoriteButton({ car }: { car: ICar }) {
  const favorites = useStore(useFavoritesStore, (state) => state.favorites);
  const toggleFavorite = useFavoritesStore((state) => state.toggleFavorite);

  // –°—Ç–∞–Ω –≥—ñ–¥—Ä–∞—Ü—ñ—ó
  if (favorites === undefined) {
    return <div className="w-6 h-6 bg-gray-200 animate-pulse rounded-full" />;
  }

  const isFav = favorites.some((f) => f.id === car.id);

  return (
    <button onClick={() => toggleFavorite(car)} className="text-2xl">
      {isFav ? '‚ù§Ô∏è' : 'ü§ç'}
    </button>
  );
}

```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£ –∫–∞—Ç–∞–ª–æ–∑—ñ —Ç–∏ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—à `<FavoriteButton car={car} />`, —ñ –≤–æ–Ω–∞ —Å–∞–º–∞ –∑–Ω–∞—î, –∫–æ–ª–∏ –±—É—Ç–∏ —Å–∫–µ–ª–µ—Ç–æ–Ω–æ–º, –∞ –∫–æ–ª–∏ ‚Äî –∫–Ω–æ–ø–∫–æ—é.

---

### 2. –ì–ª–æ–±–∞–ª—å–Ω–∏–π Provider (High-level —Ä—ñ—à–µ–Ω–Ω—è)

–ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ "–∑–∞–≤—ñ—Å—É" –Ω–∞ –≤–µ—Å—å –¥–æ–¥–∞—Ç–æ–∫, —è–∫–∞ –Ω–µ –ø–æ–∫–∞–∂–µ –∫–æ–Ω—Ç–µ–Ω—Ç, –ø–æ–∫–∏ `localStorage` –Ω–µ –∑—á–∏—Ç–∞–Ω–æ. –ê–ª–µ —Ü–µ **–ø–æ–≥–∞–Ω–∏–π UX**, –±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±—É–¥–µ –±–∞—á–∏—Ç–∏ –ø—É—Å—Ç–∏–π –µ–∫—Ä–∞–Ω –∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± —É–∂–µ —á–∏—Ç–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∞–≤—Ç–æ.

---

### 3. "–ó–∞—Ö–∏—â–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç" (Wrapper –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)

–ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ClientOnly`, —è–∫–∏–π —Ö–æ–≤–∞—î —Å–≤—ñ–π –≤–º—ñ—Å—Ç –¥–æ –º–æ–º–µ–Ω—Ç—É –≥—ñ–¥—Ä–∞—Ü—ñ—ó.

**–§–∞–π–ª `components/ClientOnly.tsx`:**

```tsx
'use client';
import { ReactNode, useEffect, useState } from 'react';

export default function ClientOnly({ children, fallback }: { children: ReactNode, fallback: ReactNode }) {
  const [hasMounted, setHasMounted] = useState(false);
  useEffect(() => setHasMounted(true), []);

  if (!hasMounted) return <>{fallback}</>;
  return <>{children}</>;
}

```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**

```tsx
<ClientOnly fallback={<MySkeleton />}>
  <FavoriteButton car={car} />
</ClientOnly>

```

---

### –Ø–∫–∏–π —à–ª—è—Ö –æ–±—Ä–∞—Ç–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É?

–û—Å–∫—ñ–ª—å–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç—ñ "Rental Car" —Å—Ç–∞–Ω –æ–±—Ä–∞–Ω–æ–≥–æ –≤–ø–ª–∏–≤–∞—î –ª–∏—à–µ –Ω–∞ **—ñ–∫–æ–Ω–∫—É —Å–µ—Ä—Ü—è** —Ç–∞ **—Å—Ç–æ—Ä—ñ–Ω–∫—É Favorites**, —è —Ä–∞–¥–∂—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–í–∞—Ä—ñ–∞–Ω—Ç ‚Ññ1**.

–ú–∏ —Å—Ç–≤–æ—Ä–∏–º–æ –æ–¥–Ω—É —Ä–æ–∑—É–º–Ω—É –∫–Ω–æ–ø–∫—É `FavoriteButton` —Ç–∞ –æ–¥–Ω—É —Ä–æ–∑—É–º–Ω—É –∫–∞—Ä—Ç–∫—É `CarCard`, —è–∫—ñ —Å–∞–º—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–±—Ä–æ–±–ª—è—é—Ç—å —Å–≤—ñ–π —Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∑–∞–ª–∏—à–∏—Ç—å—Å—è —á–∏—Å—Ç–æ—é.

**–ß–∏ —Ö–æ—á–µ—à –º–∏ –∑–∞—Ä–∞–∑ –≤–∏–Ω–µ—Å–µ–º–æ —Ü—é –ª–æ–≥—ñ–∫—É –≤ –æ–∫—Ä–µ–º–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `FavoriteButton`, —â–æ–± –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –≥—Ä—É–Ω—Ç –¥–ª—è –ö—Ä–æ–∫—É 4 (–ö–∞—Ç–∞–ª–æ–≥—É)?** –ê–±–æ –≤—ñ–¥—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥–µ–º–æ –¥–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Å—Ç–æ—Ä—É –¥–ª—è –º–∞—à–∏–Ω?